{% extends 'base.html' %}

{% load static %}
{% block title %}{{ cuadro.nombre }}{% endblock title %}

{% block content %}

<div id="loader-overlay" class="loader-overlay">
  <div class="loader">

    <img src="{% static 'ejemplos/loader_ah.png' %}" alt="Loader Image">
    <div class="progress">
      <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0"
        aria-valuemin="0" aria-valuemax="100"></div>
    </div>
  </div>
</div>

<!-- No borrar para que funcione el loader -->
<div id="coleccion-new" style="visibility: hidden;">
</div>

<nav class="navbar navbar-expand-lg bg-body pb-0 pt-1">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home:obras-view' %}"><i class="bi bi-chevron-compact-left"></i>
      {{ cuadro.nombre }}</a>
  </div>
</nav>

<div class="container mb-1 p-4" id="{{ cuadro.id }}">
  <div class="row">
    <div class="col-md-8">
      <div class="row">
        {% if cuadro.imagen1 %}
        <div class="col-md-12 pb-2 px-2 position-relative">
          <img src="{{ cuadro.imagen1.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen2 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen2.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen3 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen3.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen4 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen4.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen5 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen5.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen6 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen6.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen7 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen7.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen8 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen8.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
        {% if cuadro.imagen9 %}
        <div class="col-md-6 p-2 position-relative">
          <img src="{{ cuadro.imagen9.url }}" class="d-block w-100 clickable-image rounded-image"
            alt="{{ cuadro.nombre }}" style="cursor: zoom-in;">
        </div>
        {% endif %}
      </div>
    </div>


    <div class="col-md-4 px-2 cuadro-info">
      <div class="card h-100" style="border-radius: 10px;" id="{{ cuadro.id }}">
        <div class="card-body">

          <div class="row">
            <div class="col-8">
              <h6 class="card-title mb-2" style="font-size: 24px;">{{ cuadro.nombre }}</h6>
            </div>
            <div class="col-4">
              {% if cuadro.vendido %}
              <img src="{% static 'ejemplos/vendido.png' %}" class="img-fluid">
              {% endif %}
            </div>
          </div>



          <a class="card-subtitle text-muted" href="{% url 'home:coleccion-view' %}?coleccion={{ cuadro.coleccion }}"
            style="text-decoration: none;">
            <h6 class="card-subtitle text-muted mb-3" style="font-size: 14px;">{{ cuadro.coleccion }}
            </h6>
          </a>


          {% if cuadro.descuento %}
          <p class="card-text text-danger mb-0" style="text-decoration: line-through;">$ {{ cuadro.precio_punto_con }}
            CLP</p>
          <p class="card-text"><strong>$ {{ cuadro.precio_con_descuento }} CLP</strong> (Marco incluido)</p>
          {% else %}
          <p class="card-text"><strong>$ {{ cuadro.precio_punto_con }} CLP</strong> (Marco incluido)</p>
          {% endif %}

          <a href="{% url 'home:contacto-view'%}" class="btn btn-outline-dark mb-3">Contacto</a>
          <p class="card-text">{{ cuadro.descripcion|linebreaksbr }}</p>

          <p class="card-text">Técnica: {{ cuadro.tecnica }}</p>


          <div class="col-12">
            <ul class="list-unstyled">
              <!-- {% if cuadro.marco_sin %}
                <li>Dimensiones sin marco: {{ cuadro.marco_sin }}</li>
                {% endif %} -->
              {% if cuadro.marco_con %}
              <li>Dimensiones con marco: {{ cuadro.marco_con }}</li>
              {% endif %}
            </ul>
          </div>



          <!-- <div class="col-12">
            <ul class="list-unstyled">
              {% if cuadro.precio_sin %}
                <li>Precio sin marco: $ {{ cuadro.precio_punto_sin}} CLP</li>
                {% endif %}
              {% if cuadro.precio_con %}
              <li>Precio con marco: $ {{ cuadro.precio_punto_con }} CLP</li>
              {% endif %}
            </ul>
          </div> -->


          <p class="card-text">Fecha: {{ cuadro.fecha|date:"Y" }}</p>

          {% if cuadro.cantidad_inicial %}
          <p class="card-text">Disponibilidad: {{ cuadro.cuadros_disponibles }} de {{ cuadro.cantidad_inicial }}</p>
          {% endif %}

        </div>
        <a href="{% url 'home:contacto-view' %}" class="btn btn-dark boton-contacto">Contacto</a>
      </div>
    </div>
  </div>
</div>

<!-- Modal for full-size image -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body">
        <img id="modalImage" src="" class="d-block w-100" data-bs-dismiss="modal" style="cursor: zoom-out;">
      </div>
    </div>
  </div>
</div>


<nav class="navbar navbar-expand-lg bg-body">
  <div class="container-fluid">
    <a class="navbar-brand text-break text-wrap">Colección completa: {{ cuadro.coleccion }}</a>
  </div>
</nav>
<br>


<div class="slider-containerSW swiper slider" id="slider-new">
  <div class="slider-content-new">
    <div class="cardSW-wrapper swiper-wrapper">
      {% for cuadro in coleccion_ordenada %}
      <div class="cardSW swiper-slide">
        <div class="image-content py-0">
          <span class="overlay"></span>
          <div class="cardSW-image">
            <a href="{% url 'home:cuadro-view' cuadro.id %}">
              <img src="{{ cuadro.imagen1.url }}" />
              {% if cuadro.vendido %}
              <div class="sold-overlay"></div>
              {% endif %}
            </a>
          </div>
        </div>

        <div class="cardSW-content py-0"> <!-- Aplicar padding igual arriba y abajo al contenido del botón -->
          <h3 class="nameSW text-lg pt-3">{{ cuadro.nombre }}</h3>
        </div>

      </div>
      {% endfor %}
    </div>
  </div>

  <div class="swiper-pagination"></div>
  <div class="swiper-button-next swiper-navBtn"></div>
  <div class="swiper-button-prev swiper-navBtn"></div>
</div>

<br>
<nav class="navbar navbar-expand-lg bg-body">
  <div class="container-fluid">
    <a class="navbar-brand text-break text-wrap">Trabajos relacionados</a>
  </div>
</nav>
<br>

<div class="slider-containerSW swiper slider" id="slider01">
  <div class="slider-content">
    <div class="cardSW-wrapper swiper-wrapper">
      <!-- Contenido del slider random -->
      {% for cuadro in lista_cuadros|slice:":10" %}
      <div class="cardSW swiper-slide">
        <div class="image-content py-0"> <!-- Aplicar padding igual arriba y abajo a la imagen -->
          <span class="overlay"></span>
          <div class="cardSW-image">
            <a href="{% url 'home:cuadro-view' cuadro.id %}">
              <img src="{{ cuadro.imagen1.url }}" />
              {% if cuadro.vendido %}
              <div class="sold-overlay"></div> <!-- Superpone la imagen de vendido si el cuadro está vendido -->
              {% endif %}
            </a>
          </div>
        </div>
        <div class="cardSW-content py-0"> <!-- Aplicar padding igual arriba y abajo al contenido del botón -->
          <h3 class="nameSW text-lg pt-3">{{ cuadro.nombre }}</h3>
          <p class="descriptionSW">{{ cuadro.coleccion }}</p>
          <a href="{% url 'home:cuadro-view' cuadro.id %}" class="btn btn-dark">Ver</a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="swiper-pagination"></div>
  <div class="swiper-button-next swiper-navBtn"></div>
  <div class="swiper-button-prev swiper-navBtn"></div>
</div>

<br>



{% endblock content %}

{% block scripts %}
<script>

  document.addEventListener("DOMContentLoaded", function () {
    var loaderOverlay = document.getElementById('loader-overlay');
    var sliderContainer = document.getElementById('coleccion-new');
    var progressBar = document.getElementById('progress-bar');
    var progress = 0;
    var duration = 1500; // 3 segundos
    var interval = 50; // Intervalo de actualización en milisegundos

    disableScroll(); // Deshabilitar el scroll de la página

    var progressInterval = setInterval(function () {
      progress += interval / duration * 100;
      progressBar.style.width = progress + '%';
      progressBar.setAttribute('aria-valuenow', progress);

      if (progress >= 100) {
        clearInterval(progressInterval);
        loaderOverlay.style.display = 'none';
        sliderContainer.style.visibility = 'visible'; // Cambiar la visibilidad del contenedor principal del slider a 'visible'
        enableScroll(); // Volver a habilitar el scroll de la página
      }
    }, interval);
  });

  function disableScroll() {
    document.body.style.overflow = 'hidden';
  }

  function enableScroll() {
    document.body.style.overflow = 'auto';
  }


  var swiper = new Swiper(".slider-content-new", {
    slidesPerView: 5,
    spaceBetween: 25,
    loop: true,
    centerSlide: true,
    fade: true,
    grabCursor: true,
    navigation: {
      nextEl: "#slider-new .swiper-button-next",
      prevEl: "#slider-new .swiper-button-prev",
    },
    breakpoints: {
      0: {
        slidesPerView: 1,
      },
      520: {
        slidesPerView: 2,
      },
      950: {
        slidesPerView: 3,
      },
      1100: {
        slidesPerView: 4,
      },
      1100: {
        slidesPerView: 5,
      },
    },
  });

  // Handle image click to show in modal
  document.querySelectorAll('.clickable-image').forEach(function (img) {
    img.addEventListener('click', function () {
      var src = this.getAttribute('src');
      document.getElementById('modalImage').setAttribute('src', src);
      var imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
      imageModal.show();
    });
  });



</script>
{% endblock scripts %}