{% extends 'base.html' %}
<!-- revisar el load static -->
{% block title %}Caleta: Quieros{% endblock title %}

{% block content %}
{% now "d-m-Y" as fecha_hoy %}


<div class="ui grid stackable">
    {% for obj in quieros %}
    {% if obj.status_q != 'Aceptada' or obj.status_q == 'Aceptada' and request.user == obj.queredor.user %}

    <div class="sixteen wide column">
        <div
            class="ui fluid card  {% if obj.urgencia_q_opcion == "Con Urgencia" %} yellow {% elif request.user == obj.queredor.user %} pink {% elif request.user in obj.ofertantes %} orange {% else %} teal {% endif %}">
            <div class="content">
                <div class="ui grid stackable">
                    <div class="four wide center column">
                        <div class="row">
                            <a href="{{obj.queredor.get_absolute_url}}">
                                <div class="ui header blue aligned tiny mt-7 mb-7">
                                    &nbsp&nbsp{{obj.queredor.user|upper}} quiere:</div>
                            </a>
                        </div>
                        <div class="row">
                            <div class="{% if obj.urgencia_q_opcion == "Con Urgencia" %} ui label yellow big fluid
                                {% elif request.user == obj.queredor.user %} ui label basic pink big fluid
                                {% elif request.user in obj.ofertantes %} ui label basic orange big fluid {% else %} ui label basic teal big fluid {% endif %}"
                                <i class="heart icon"></i> {{obj.quiero_q|upper}}
                            </div>
                        </div>
                    </div>
                    <div class="five wide column mt-7">
                        <div class="row">
                            <div class="ui header blue aligned tiny mt-5">
                                <i class="calendar icon"></i>
                                {{obj.fecha_q_opcion}}: {{obj.fecha_q|date:"d-m-Y"}}
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="ui header blue aligned tiny"><i class="world icon"></i>
                                {{obj.comuna_q_opcion}}
                            </div>
                        </div>
                    </div>

                    <div class="two wide column">
                        <div class="center aligned grid">
                            {% if obj.imagen_q == "quieros/no_image1.png" %}
                            {% else %}


                            <div class="column">
                                <img class="ui middle aligned rounded bordered centered image" src={{obj.imagen_q.url}}
                                    style="max-height:75px;width:auto;border:0px;">
                            </div>


                            {% endif %}
                        </div>
                    </div>

                    <div class="three wide column">
                        {% if request.user == obj.queredor.user and obj.status_q != 'Aceptada' %}
                        <div class="right aligned grid">
                            <div class="row">
                                <div class="ui labeled button fluid mt-7" style="pointer-events: none;">
                                    <div class="ui basic fluid violet tiny button">
                                        <i class="crosshairs icon"></i> Ofertantes
                                    </div>
                                    <a class="ui left pointing violet label">
                                        {{ obj.get_ofertas_num }}
                                    </a>
                                </div>
                            </div>
                            <div class="row">
                                <a href="{{obj.get_absolute_url_delete}}">
                                    <button class="ui small button bwhite-lg ">Borrar
                                        Quiero
                                    </button>
                                </a>
                            </div>
                        </div>
                        {% else %}
                        <div class="right aligned grid">
                            <br>
                            <div class="row">
                                <div class="ui labeled button fluid" style="pointer-events: none;">
                                    <div class="ui basic fluid violet tiny button">
                                        <i class="crosshairs icon"></i> Ofertantes
                                    </div>
                                    <a class="ui left pointing violet label">
                                        {{ obj.get_ofertas_num }}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="two wide column right aligned">
                        <br>
                        <button class="abrir_q_btn ui inverted blue  button large" data-ver-id="{{obj.pk}}">Ver</button>

                    </div>
                </div>
            </div>




            <div class="comment-box" id=cb{{obj.pk}}>
                <!-- Nego -->
                {% if request.user in obj.ofertantes %}
                <div class="content">
                    <div id="context-tab{{obj.pk}}" data-nego-tabs-id="{{obj.pk}}" class="nego-tabs">

                        {% for o in obj.oferta_set.all %}
                        <div class="ui tab" data-tab="{{o.pk}}">
                            <div class=" ui top attached tabular menu">
                                {% for n in o.get_negos|slice:":17" %}
                                <a class="item" data-tab="{{o.pk}}/{{n.pk}}">{{n.slug_n_num}}</a>
                                {% endfor %}
                            </div>
                            {% for n in o.get_negos|slice:":17" %}
                            <div class="ui bottom attached tab segment" data-tab="{{o.pk}}/{{n.pk}}">

                                <div class="ui grid container stackable">
                                    <div class="row">
                                        <div {% if n.status_n == "Negociando" %} class="seven wide column" {% else %}
                                            class="twelve wide column" {% endif %}>
                                            <table class="ui table teal">
                                                <thead>
                                                    <tr>
                                                        <th>

                                                        </th>
                                                        <th class="center aligned">
                                                            <h4 class="ui header orange">
                                                                Quiero
                                                            </h4>
                                                        </th>
                                                        <th></th>
                                                        <th class="center aligned">
                                                            <h4 class="ui header teal">
                                                                Mi Oferta RRR
                                                            </h4>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr {% if n.status_n == 'Aceptada' %} class="positive" {% endif %}
                                                        {% if n.obs_n_q is None or n.obs_n_q == "" %}
                                                        {% if n.obs_n_o is None or n.obs_n_o == "" %} class="positive"
                                                        {% endif %} {% else %} class="warning" {% endif %}
                                                        {% if n.obs_n_o is None or n.obs_n_o == "" %}
                                                        {% if n.obs_n_q is None or n.obs_n_q == "" %} class="positive"
                                                        {% endif %} {% else %} class="warning" {% endif %}>
                                                        <td>
                                                            <i class="icon comment outline"></i>Comentarios:
                                                        </td>
                                                        {% if n.obs_n_q is None or n.obs_n_q == "" %}
                                                        <td class="center aligned">
                                                            <div class="ui disabled green inverted tiny button">Sin <p>
                                                                    Comentarios
                                                                </p>
                                                            </div>
                                                        </td>
                                                        <td></td>
                                                        {% else %}
                                                        <td class="center aligned">
                                                            <label class="ui orange pop tiny inverted button"
                                                                data-title="Comentario:" data-content="{{n.obs_n_q}} ">
                                                                Ver<p>Comentario</p>
                                                            </label>
                                                        </td>
                                                        {% if n.status_n == 'Aceptada' %}
                                                        <td class="positive center aligned"><i
                                                                class="icon square check"></i>
                                                        </td>
                                                        {% else %}
                                                        <td class="warning center aligned"><i
                                                                class="icon attention"></i>
                                                        </td>
                                                        {% endif %}
                                                        {% endif %}



                                                        {% if n.obs_n_o is None or n.obs_n_o == "" %}
                                                        <td class="center aligned">
                                                            <div class="ui disabled green inverted tiny button">Sin <p>
                                                                    Comentarios
                                                                </p>
                                                            </div>
                                                        </td>
                                                        {% else %}
                                                        <td class="center aligned">
                                                            <label class="ui orange pop tiny inverted button"
                                                                data-title="Comentario:" data-content="{{n.obs_n_o}} ">
                                                                Ver<p>Comentario</p>
                                                            </label>
                                                        </td>
                                                        {% endif %}

                                                    </tr>

                                                    <tr class={% if n.status_cantidad_n == 'Aceptada' %} "positive"
                                                        {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                        {% endif %}>
                                                        <td><i class="sort numeric up icon"></i>Cantidad<p>
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofrecida
                                                                :
                                                            </p>
                                                        </td>
                                                        <td class="center aligned">{{obj.cantidad_q}}</td>
                                                        {% if n.status_n == "Pendiente" %}
                                                        <td class="center aligned"><i class="icon hourglass half"></i>
                                                        </td>
                                                        {% elif n.status_cantidad_n == 'Aceptada' %}
                                                        <td class="positive center aligned"><i
                                                                class="icon check square"></i>
                                                        </td>
                                                        {% else %}
                                                        <td class="negative center aligned"><i class="icon close"></i>
                                                        </td>
                                                        {% endif %}
                                                        <td class="center aligned">
                                                            <strong>{% if n.cantidad_n_o is None %}
                                                                Pendiente {% else %}
                                                                {{n.cantidad_n_o}}{% endif %}</strong></td>
                                                    </tr>

                                                    <tr class={% if n.status_fecha_n == 'Aceptada' or n.fecha_n_q_opcion == 'Fecha Exacta' %} "positive"
                                                        {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                        {% endif %}>
                                                        <td> <i class="calendar  icon"> </i>
                                                            Fecha<p>
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofrecida
                                                                :
                                                            </p>
                                                        </td>
                                                        <td class="center aligned">
                                                            {% if obj.fecha_q_opcion == 'Sin Fecha' %}
                                                            {% elif obj.fecha_q_opcion == 'Fecha Límite' %}
                                                            Fecha Límite
                                                            {% elif obj.fecha_q_opcion == 'Fecha Exacta' %}
                                                            Fecha Exacta
                                                            {% endif %}
                                                            <p>{{obj.fecha_q|date:"d-m-Y"}}</p>
                                                        </td>
                                                        {% if n.status_fecha_n == 'Aceptada' or n.fecha_n_q_opcion == 'Fecha Exacta' %}
                                                        <td class="positive center aligned"><i
                                                                class="icon square check"></i>
                                                        </td>
                                                        {% elif n.status_n == "Pendiente" %}
                                                        <td class="center aligned"><i class="icon hourglass half"></i>
                                                        </td>
                                                        {% else %}
                                                        <td class="negative center aligned"><i class="icon close"></i>
                                                        </td>
                                                        {% endif %}
                                                        <td class="center aligned"><strong>{% if n.fecha_n_o is None %}
                                                                Pendiente {% else %}
                                                                {{n.fecha_n_o|date:"d-m-Y"}}{% endif %}
                                                            </strong>
                                                        </td>
                                                    </tr>
                                                    <tr class={% if n.status_envio_n == 'Aceptada' or n.envio_n_o_opcion == 'No se necesita' or n.envio_n_o_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga'%} "positive"
                                                        {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                        {% endif %}>
                                                        <td><i class="shipping fast icon"></i>
                                                            Tipo de<p>
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envio :
                                                                {{obj.comuna_q}}</p>
                                                        </td>
                                                        <td class="center aligned">{{obj.envio_q_opcion}}</td>
                                                        {% if n.status_envio_n == 'Aceptada' or n.envio_n_o_opcion == 'No se necesita' or obj.envio_q_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga' %}
                                                        <td class="positive center aligned"><i
                                                                class="icon square check"></i>
                                                        </td>
                                                        {% elif n.status_n == "Pendiente" %}
                                                        <td class="center aligned"><i class="icon hourglass half"></i>
                                                        </td>
                                                        {% else %}
                                                        <td class="negative center aligned"><i class="icon close"></i>
                                                        </td>
                                                        {% endif %}
                                                        <td class="center aligned">
                                                            <strong>{{n.envio_n_o_opcion}}</strong></td>
                                                    </tr>

                                                    <tr class={% if n.status_precio_n == 'Aceptada' %} "positive"
                                                        {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                        {% endif %}>
                                                        <td><i class="balance scale icon"></i>
                                                            Precio Final<p>
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofrecido
                                                                :
                                                            </p>
                                                        </td>
                                                        <td></td>
                                                        {% if n.status_n == "Pendiente" %}
                                                        <td class="center aligned"><i class="icon hourglass half"></i>
                                                        </td>
                                                        {% elif n.status_precio_n == 'Aceptada' %}
                                                        <td class="positive center aligned"><i
                                                                class="icon check square"></i>
                                                        </td>
                                                        {% else %}
                                                        <td class="negative center aligned"><i class="icon close"></i>
                                                        </td>
                                                        {% endif %}
                                                        <td class="center aligned"> $
                                                            <strong>{{n.precio_en_miles}}</strong>
                                                        </td>
                                                    </tr>

                                                </tbody>
                                            </table>
                                        </div>



                                        {% if n.status_n == "Negociando" %}
                                        <div class="five wide column">
                                            <table class="ui table violet">
                                                <thead>
                                                    <tr>
                                                        <th class="center aligned">
                                                            <h4 class="ui header violet">
                                                                Nueva Oferta KK
                                                            </h4>
                                                        </th>
                                                    </tr>
                                                </thead>

                                                <form method="POST" id="form_tabla_nego_2{{n.pk}}"
                                                    action="{% url 'quieros:nego-2' %}" enctype="multipart/form-data">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="quiero_pk" value={{obj.pk}}>
                                                    <input type="hidden" name="oferta_pk" value={{o.pk}}>
                                                    <input type="hidden" name="nego_slug" value={{n.slug}}>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                <div class="ui form">
                                                                    <div class="inline fields mb-1">
                                                                        <div class="eleven wide field">
                                                                            <textarea type="text" name="obs_n_o "
                                                                                placeholder="Comentario" cols="30"
                                                                                rows="1"
                                                                                style="resize: none;"></textarea>
                                                                        </div>
                                                                        <div class="five wide field mb-1">
                                                                            <div>
                                                                                <label for="file-{{n.pk}}"
                                                                                    class="ui red inverted small button">
                                                                                    Subir Imagen</label>
                                                                                <input type="file" id="file-{{n.pk}}"
                                                                                    style="display:none"
                                                                                    name="imagen_n_o">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td {% if n.status_n == "Pendiente" %} class="warning"
                                                                {% elif n.status_cantidad_n == 'Aceptada' %}
                                                                class="positive" {% else %} class="negative"
                                                                {% endif %}>
                                                                <div class="ui form">
                                                                    <div class="inline fields mb-0">
                                                                        <div class="ten wide field">
                                                                            <i
                                                                                class="sort numeric up icon"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                            Cantidad:
                                                                        </div>
                                                                        <div class="six wide field">

                                                                            <input type="number" name="cantidad_n_o"
                                                                                placeholder="Nueva"
                                                                                value={{n.cantidad_n_o}}
                                                                                style="width:117px" pattern="[0-9]+"
                                                                                min="0">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class={% if n.status_fecha_n == 'Aceptada' or n.fecha_n_q_opcion == 'Sin Fecha' or n.fecha_n_q_opcion == 'Fecha Exacta' %}"positive"
                                                            {% else %} "negative" {% endif %}>
                                                            <td>
                                                                <div class="ui form">
                                                                    <div class="inline fields mb-0">
                                                                        <div class="ten wide field">
                                                                            <i class="calendar  icon"> </i>
                                                                            {% if n.fecha_n_q_opcion == 'Fecha Límite' %}
                                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fecha de envio
                                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;estimada:
                                                                            {% else %}
                                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{n.fecha_n_q_opcion}}:
                                                                            {% endif %}
                                                                        </div>
                                                                        <div class="six wide field">
                                                                            {% if n.fecha_n_q_opcion == 'Sin Fecha' %}
                                                                            <div class="ui calendar">
                                                                                <input type="text" autocomplete="off"
                                                                                    style="width:117px"
                                                                                    value="Sin Fecha" disabled>
                                                                                <input type="hidden"
                                                                                    name="fecha_calendario_n_o"
                                                                                    value="">
                                                                            </div>
                                                                            {% elif n.fecha_n_q_opcion == 'Fecha Exacta' %}
                                                                            <div class="ui calendar"
                                                                                id="fecha-calendario-o"
                                                                                data-min-date="{{n.fecha_n_q}}"
                                                                                data-max-date="{{n.fecha_n_q}}">
                                                                                <input type="text" autocomplete="off"
                                                                                    value="{{n.fecha_n_q}}" disabled
                                                                                    style="width:117px">
                                                                                <input type="hidden"
                                                                                    name="fecha_calendario_n_o"
                                                                                    value="{{n.fecha_n_q}}">
                                                                            </div>
                                                                            {% else %}

                                                                            {% if fecha_hoy == obj.fecha_q|date:"d-m-Y" %}
                                                                            <div class="ui calendar"
                                                                                id="fecha-calendario-o"
                                                                                data-min-date="{{n.fecha_n_q}}"
                                                                                data-max-date="{{n.fecha_n_q}}">
                                                                                <input type="text" autocomplete="off"
                                                                                    value="{{n.fecha_n_q}}" disabled
                                                                                    style="width:117px">
                                                                                <input type="hidden"
                                                                                    name="fecha_calendario_n_o"
                                                                                    value="{{n.fecha_n_q}}">
                                                                            </div>
                                                                            {% else %}
                                                                            <div class="ui calendar"
                                                                                id="fecha-calendario-o"
                                                                                data-min-date={% now "d-m-Y" %}
                                                                                data-max-date="{{n.fecha_n_q|date:"d-m-Y"}}">
                                                                                <input type="text"
                                                                                    name="fecha_calendario_n_o"
                                                                                    placeholder="Fecha"
                                                                                    value="{{n.fecha_n_o}}"
                                                                                    autocomplete="off"
                                                                                    style="width:117px">
                                                                            </div>
                                                                            {% endif %}
                                                                            {% endif %}

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class={% if n.envio_n_o_opcion == 'No se necesita' or n.envio_n_o_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga'%} "positive"
                                                            {% endif %}>
                                                            <td>
                                                                <div class="ui form">
                                                                    <div class="inline fields mb-0">
                                                                        <div {% if obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                                            class="seven wide field" {% else %}
                                                                            class="ten wide field" {% endif %}>
                                                                            <i
                                                                                class="shipping fast alternate outline icon"></i>
                                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Envio:

                                                                        </div>
                                                                        <div {% if obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                                            class="ten wide field" {% else %}
                                                                            class="six wide field" {% endif %}>

                                                                            {% if obj.envio_q_opcion == 'No se necesita' %}
                                                                            <input type="text" value="No se necesita"
                                                                                style="width:117px" disabled>
                                                                            <input type="hidden" name="envio_radio_o"
                                                                                value="No se necesita">
                                                                            {% elif obj.envio_q_opcion == 'Queredor se encarga' %}
                                                                            <input type="text" value="Él se encarga"
                                                                                style="width:117px" disabled>
                                                                            <input type="hidden" name="envio_radio_o"
                                                                                value="Él se encarga">
                                                                            {% elif obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                                            <div class="field">
                                                                                <div class="ui radio checkbox">
                                                                                    <input type="radio"
                                                                                        name="envio_radio_o" checked=""
                                                                                        value="ofertante_se_encarga"
                                                                                        tabindex="0" class="hidden">
                                                                                    <label>Yo me encargo</label>
                                                                                </div>
                                                                            </div>
                                                                            <div class="field">
                                                                                <div class="ui radio checkbox">
                                                                                    <input type="radio"
                                                                                        name="envio_radio_o"
                                                                                        value="otro_se_encarga"
                                                                                        tabindex="0" class="hidden">
                                                                                    <label>Otra Empresa</label>
                                                                                </div>
                                                                            </div>
                                                                            {% endif %}

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        <tr {% if n.status_n == "Pendiente" %} class="warning"
                                                            {% elif n.status_precio_n == 'Aceptada' %} class="positive"
                                                            {% else %} class="negative" {% endif %}>
                                                            <td>
                                                                <div class="ui form">
                                                                    <div class="inline fields mb-0">
                                                                        <div class="ten wide field">
                                                                            <i
                                                                                class="balance scale icon"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Precio:
                                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$
                                                                        </div>
                                                                        <div class="six wide field">
                                                                            <input type="number" name="precio_n_o"
                                                                                placeholder="Pendiente"
                                                                                value="{{n.precio_n_o}}"
                                                                                style="width:117px" pattern="[0-9]+">
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </td>
                                                        </tr>

                                                    </tbody>
                                            </table>
                                            </form>
                                        </div>
                                        {% endif %}

                                        <div class="four wide column">
                                            <div class="ui fluid vertical buttons">

                                                {% if n.status_n == 'Pendiente' %}
                                                {% if obj.queredor.user == request.user %}
                                                <div class="ui label mb-5 center aligned massive pink segment"><i
                                                        class="clock icon"></i>Esperando Tu Respuesta
                                                </div>
                                                {% else %}
                                                <div class="ui label mb-5 center aligned massive violet segment"><i
                                                        class="clock icon"></i>Esperando RespuestaVV
                                                </div>
                                                {% endif %}
                                                {% elif n.status_n == 'Negociando' %}
                                                <div class="ui label mb-5 center aligned massive teal segment"><i
                                                        class="clock icon"></i>Esperando Tu Oferta
                                                </div>
                                                {% elif n.status_n == 'Rechazada' %}
                                                <div class="ui label mb-5 center aligned massive red segment"><i
                                                        class="ban icon"></i>Oferta
                                                    Rechazada
                                                </div>
                                                {% elif n.status_n == 'Aceptada' %}
                                                <div class="ui label mb-5 center aligned green massive segment">
                                                    <i class="trophy icon"></i> Oferta Aceptada</div>

                                                {% elif obj.queredor.user == request.user and obj.get_ofertas_num == 0 %}
                                                <div class="ui label mb-5 center aligned massive violet segment"><i
                                                        class="ban icon"></i>Esperando x Ofertas
                                                </div>hourglass half
                                                {% elif obj.queredor.user != request.user and n.status_n != "Antigua" %}
                                                {% if user.is_authenticated %}
                                                <a>
                                                    <button type="submit" name="submit_o_form"
                                                        form="form_tabla_oferta{{obj.pk}}" value={{obj.pk}}
                                                        class="ui inverted violet huge button mb-5"
                                                        id="enviar-oferta"><i class="bullhorn icon"></i>Ofrecer
                                                    </button>
                                                </a>
                                                {% else %}
                                                <a href={% url 'login' %}?next={{request.path}}>
                                                    <button class="ui inverted violet huge button mb-5"><i
                                                            class="bullhorn icon"></i>
                                                        Ofrecer
                                                    </button>
                                                </a>
                                                {% endif %}
                                                {% endif %}

                                                {% if n.status_n == 'Negociando' and obj.queredor.user != request.user %}
                                                <a>
                                                    <button type="submit" name="submit_nego_form_2"
                                                        form="form_tabla_nego_2{{n.pk}}" value={{n.pk}}
                                                        class="ui inverted violet huge button mb-5"
                                                        id="enviar-oferta-checkbox"><i
                                                            class="envelope outline icon"></i>Enviar
                                                        Nueva
                                                        Oferta
                                                    </button>
                                                </a>
                                                {% elif n.status_n == 'Pendiente' and obj.queredor.user == request.user %}
                                                <a>
                                                    <button type="submit" name="submit_nego_form_1"
                                                        form="form_tabla_nego_1{{n.pk}}" value={{n.pk}}
                                                        class="ui inverted purple huge button mb-5"
                                                        data-nueva-propuesta-id="{{n.pk}}"
                                                        id="enviar-propuesta-checkbox{{n.pk}}"><i
                                                            class="envelope outline icon"></i>Enviar
                                                        Nueva
                                                        Propuesta WEWE {{n.pk}}
                                                    </button>
                                                </a>
                                                <form action="{% url 'quieros:oferta-aceptar' %}" method="POST">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="quiero_pk_aceptar" value={{obj.pk}}>
                                                    <input type="hidden" name="oferta_pk_aceptar" value={{o.pk}}>
                                                    <input type="hidden" name="nego_pk_aceptar" value={{n.pk}}>
                                                    <button type="submit" name="submit_a_form"
                                                        class="ui inverted green huge button mb-5"
                                                        data-aceptar-oferta-id="{{n.pk}}"
                                                        id="aceptar-oferta-checkbox{{n.pk}}" style="display: none;">
                                                        <i class="handshake icon"></i>SSAceptar q{{obj.pk}} o{{o.pk}}
                                                        n{{n.pk}}</button>
                                                </form>
                                                {% endif %}

                                                {% if obj.queredor.user == request.user %}
                                                <a href="{% url 'quieros:negociacion-view' obj.slug %}">
                                                    <button type="button" class="ui inverted blue big button mb-5"><i
                                                            class="list ol icon"></i>Ofertas Anteriores {{obj.slug}}
                                                    </button>
                                                </a>
                                                {% if n.status_n == "Pendiente" or n.status_n == "Negociando"  %}
                                                <form action="{% url 'quieros:oferta-rechazar' %}" method="POST">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="oferta_pk_rechazo" value={{o.pk}}>
                                                    <button type="submit" name="submit_r_form"
                                                        class="ui inverted red button mb-5 w-full"><i
                                                            class="trash alternate icon">
                                                        </i>Rechazar Oferta q{{obj.pk}} o{{o.pk}}</button>
                                                </form>
                                                {% endif %}

                                                {% endif %}



                                                {% for n in acu_o %}
                                                {% if n.ofertante_n.quiero_o == o.quiero_o and n.ofertante_n.ofertante.user == o.ofertante.user %}
                                                <a href="{% url 'quieros:negociacion-view' obj.slug %}">
                                                    <button type="button" class="ui inverted blue big button mb-5"><i
                                                            class="list ol icon"></i>Ofertas Anteriores {{obj.slug}}
                                                    </button>
                                                </a>

                                                {% if n.status_n == "Pendiente" or n.status_n == "Negociando"  %}
                                                <form action="{% url 'quieros:oferta-rechazar' %}" method="POST">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="oferta_pk_rechazo" value={{o.pk}}>
                                                    <a>
                                                        <button type="submit" name="submit_r_form"
                                                            class="ui inverted red large button mb-5"><i
                                                                class="x alternate icon">
                                                            </i>Retirar Ofertas</button>
                                                    </a>
                                                </form>
                                                {% endif %}
                                                {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {% endfor %}
                            <div class="extra content">{{n.slug}}//{{obj.ofertantes}}//q{{obj.pk}} o{{o.pk}}
                                n{{n.pk}}
                            </div>

                        </div>
                        {% endfor %}
                    </div>
                </div>









































                <!-- Queredor Acepata o no -->

                {% elif request.user == obj.queredor.user and obj.get_ofertas_num != 0 %}

                <div class="content">
                    <div id="context-tab{{obj.pk}}" data-nego-tabs-id="{{obj.pk}}" class="nego-tabs">
                        <div class=" ui pointing secondary menu">

                            {% for o in obj.oferta_set.all|slice:":16" %}
                            <a class="item" data-tab={{o.pk}}>{{o.ofertante.user}}</a>
                            {% endfor %}
                        </div>

                        {% for o in obj.oferta_set.all %}
                        <div class="ui tab" data-tab="{{o.pk}}">
                            <div class=" ui top attached tabular menu">
                                {% for n in o.get_negos|slice:":17" %}
                                <a class="item" data-tab="{{o.pk}}/{{n.pk}}">{{n.slug_n_num}}</a>
                                {% endfor %}
                            </div>
                            {% for n in o.get_negos|slice:":17" %}
                            <div class="ui bottom attached tab segment" data-tab="{{o.pk}}/{{n.pk}}">

                                <div class="ui grid container stackable">
                                    <div class="row">
                                        <div {% if n.status_n == "Pendiente" %} class="nine wide column" {% else %}
                                            class="twelve wide column" {% endif %}>
                                            <table class="ui table pink">
                                                <thead>
                                                    <tr>
                                                        <th>
                                                            <a href="{{o.ofertante.get_absolute_url}}">
                                                                <h4 class="ui header teal">Oferta de
                                                                    {{o.ofertante.user|upper}}
                                                                </h4>
                                        </div>
                                        </a>
                                        </th>
                                        <th class="center aligned">
                                            <h4 class="ui header orange">
                                                Quiero
                                            </h4>
                                        </th>
                                        <th></th>
                                        <th class="center aligned">
                                            <h4 class="ui header teal">
                                                Oferta JJ
                                            </h4>
                                        </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            <tr {% if n.status_n == 'Aceptada' %} class="positive" {% endif %}
                                                {% if n.obs_n_q is None or n.obs_n_q == "" %}
                                                {% if n.obs_n_o is None or n.obs_n_o == "" %} class="positive"
                                                {% endif %} {% else %} class="warning" {% endif %}
                                                {% if n.obs_n_o is None or n.obs_n_o == "" %}
                                                {% if n.obs_n_q is None or n.obs_n_q == "" %} class="positive"
                                                {% endif %} {% else %} class="warning" {% endif %}>
                                                <td>
                                                    <i class="icon comment outline"></i>Comentarios:
                                                </td>
                                                {% if n.obs_n_q is None or n.obs_n_q == "" %}
                                                <td class="center aligned">
                                                    <div class="ui disabled green inverted tiny button">Sin <p>
                                                            Comentarios
                                                        </p>
                                                    </div>
                                                </td>
                                                <td></td>
                                                {% else %}
                                                <td class="center aligned">
                                                    <label class="ui orange pop tiny inverted button"
                                                        data-title="Comentario:" data-content="{{n.obs_n_q}} ">
                                                        Ver<p>Comentario</p>
                                                    </label>
                                                </td>
                                                {% if n.status_n == 'Aceptada' %}
                                                <td class="positive center aligned"><i class="icon square check"></i>
                                                </td>
                                                {% else %}
                                                <td class="warning center aligned"><i class="icon attention"></i>
                                                </td>
                                                {% endif %}
                                                {% endif %}

                                                {% if n.obs_n_o is None or n.obs_n_o == "" %}
                                                <td class="center aligned">
                                                    <div class="ui disabled green inverted tiny button">Sin <p>
                                                            Comentarios
                                                        </p>
                                                    </div>
                                                </td>
                                                {% else %}
                                                <td class="center aligned">
                                                    <label class="ui orange pop tiny inverted button"
                                                        data-title="Comentario:" data-content="{{n.obs_n_o}} ">
                                                        Ver<p>Comentario</p>
                                                    </label>
                                                </td>
                                                {% endif %}

                                            </tr>

                                            <tr class={% if n.status_cantidad_n == 'Aceptada' %} "positive"
                                                {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                {% endif %}>
                                                <td><i class="sort numeric up icon"></i>Cantidad<p>
                                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofrecida :
                                                    </p>
                                                </td>
                                                <td class="center aligned">{{obj.cantidad_q}}</td>
                                                {% if n.status_n == "Pendiente" %}
                                                <td class="center aligned"><i class="icon hourglass half"></i></td>
                                                {% elif n.status_cantidad_n == 'Aceptada' %}
                                                <td class="positive center aligned"><i class="icon check square"></i>
                                                </td>
                                                {% else %}
                                                <td class="negative center aligned"><i class="icon close"></i></td>
                                                {% endif %}
                                                <td class="center aligned"><strong>{% if n.cantidad_n_o is None %}
                                                        Pendiente {% else %}
                                                        {{n.cantidad_n_o}}{% endif %}</strong></td>
                                            </tr>
                                            <tr class={% if n.status_fecha_n == 'Aceptada' or n.fecha_n_q_opcion == 'Fecha Exacta' %} "positive"
                                                {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                {% endif %}>
                                                <td> <i class="calendar  icon"> </i>
                                                    Fecha<p>
                                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofrecida :
                                                    </p>
                                                </td>
                                                <td class="center aligned">
                                                    {% if obj.fecha_q_opcion == 'Sin Fecha' %}
                                                    Sin Fecha
                                                    {% elif obj.fecha_q_opcion == 'Fecha Límite' %}
                                                    Fecha Límite
                                                    {% elif obj.fecha_q_opcion == 'Fecha Exacta' %}
                                                    Fecha Exacta
                                                    {% endif %}
                                                    <p>{{obj.fecha_q|date:"d-m-Y"}}</p>
                                                </td>
                                                {% if n.status_fecha_n == 'Aceptada' or n.fecha_n_q_opcion == 'Fecha Exacta' %}
                                                <td class="positive center aligned"><i class="icon square check"></i>
                                                </td>
                                                {% elif n.status_n == "Pendiente" %}
                                                <td class="center aligned"><i class="icon hourglass half"></i></td>
                                                {% else %}
                                                <td class="negative center aligned"><i class="icon close"></i></td>
                                                {% endif %}
                                                <td class="center aligned"><strong>{% if n.fecha_n_o is None %}
                                                        Pendiente {% else %}
                                                        {{n.fecha_n_o|date:"d-m-Y"}}{% endif %}
                                                    </strong>
                                                </td>

                                            </tr>
                                            <tr class={% if n.status_envio_n == 'Aceptada' or n.envio_n_o_opcion == 'No se necesita' or n.envio_n_o_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga' %} "positive"
                                                {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                {% endif %}>
                                                <td><i class="shipping fast icon"></i>
                                                    Tipo de<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envio
                                                        :
                                                        {{obj.comuna_q}}
                                                    </p>
                                                </td>
                                                <td class="center aligned">{{obj.envio_q_opcion}}</td>
                                                {% if n.status_envio_n == 'Aceptada' or n.envio_n_o_opcion == 'No se necesita' or n.envio_n_o_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga' %}
                                                <td class="positive center aligned"><i class="icon square check"></i>
                                                </td>
                                                {% elif n.status_n == "Pendiente" %}
                                                <td class="center aligned"><i class="icon hourglass half"></i></td>
                                                {% else %}
                                                <td class="negative center aligned"><i class="icon close"></i></td>
                                                {% endif %}
                                                <td class="center aligned"><strong>{{n.envio_n_o_opcion}}</strong>
                                                </td>
                                            </tr>

                                            <tr class={% if n.status_precio_n == 'Aceptada' %} "positive"
                                                {% elif  n.status_n == "Pendiente" %} "" {% else %} "negative"
                                                {% endif %}>
                                                <td><i class="balance scale icon"></i>
                                                    Precio Final<p>
                                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofrecido :
                                                    </p>
                                                </td>
                                                <td></td>
                                                {% if n.status_n == "Pendiente" %}
                                                <td class="center aligned"><i class="icon hourglass half"></i></td>
                                                {% elif n.status_precio_n == 'Aceptada' %}
                                                <td class="positive center aligned"><i class="icon check square"></i>
                                                </td>
                                                {% else %}
                                                <td class="negative center aligned"><i class="icon close"></i></td>
                                                {% endif %}
                                                <td class="center aligned"> $ <strong>{{n.precio_en_miles}}</strong>
                                                </td>
                                            </tr>

                                        </tbody>
                                        </table>
                                    </div>


                                    {% if n.status_n == "Pendiente" %}

                                    <div class="three wide column">
                                        <table class="ui table olive center aligned">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <h3 class="ui header center aligned green">
                                                            Acepto
                                                        </h3>
                                                    </th>
                                                </tr>
                                            </thead>

                                            <form method="POST" id="form_tabla_nego_1{{n.pk}}"
                                                action="{% url 'quieros:nego-1' %}" name="aceptar-oferta-form{{n.pk}}">
                                                {% csrf_token %}
                                                <input type="hidden" name="quiero_pk" value={{obj.pk}}>
                                                <input type="hidden" name="oferta_pk" value={{o.pk}}>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <div class="ui large form">
                                                                <textarea type="text" name="obs_n_q"
                                                                    placeholder="Comentario" cols="30" rows="1"
                                                                    style="resize: none;"></textarea>
                                                            </div>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td>
                                                            <div class="ui form">
                                                                <div class="inline fields">
                                                                    <div class="ten wide field mt-5">
                                                                        <i class="sort numeric up icon"></i>
                                                                        &nbsp;&nbsp;Cantidad:
                                                                    </div>
                                                                    <div class="six wide field">
                                                                        <div class="ui fitted toggle checkbox">
                                                                            <input type="checkbox"
                                                                                name="check_oferta_cantidad" value="1"
                                                                                id="check-oferta{{n.pk}}"
                                                                                data-checkbox-id="check-oferta{{n.pk}}">
                                                                            <label></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr class={% if n.fecha_n_q_opcion == 'Fecha Exacta'%} "positive"
                                                        {% endif %}>
                                                        <td>
                                                            <div class="ui form">
                                                                <div class="inline fields">
                                                                    <div class="ten wide field mt-5">
                                                                        <i class="calendar icon"></i>
                                                                        &nbsp;&nbsp;Fecha:
                                                                    </div>
                                                                    <div class="six wide field">
                                                                        <div class="ui fitted toggle checkbox">
                                                                            {% if n.fecha_n_q_opcion == 'Fecha Exacta'%}
                                                                            <input type="checkbox"
                                                                                id="check-oferta{{n.pk}}" checked
                                                                                disabled
                                                                                data-checkbox-id="check-oferta{{n.pk}}">
                                                                            <input type="hidden"
                                                                                name="check_oferta_fecha" value="1"
                                                                                checked>
                                                                            {% else %}
                                                                            <input type="checkbox"
                                                                                name="check_oferta_fecha" value="1"
                                                                                id="check-oferta{{n.pk}}"
                                                                                data-checkbox-id="check-oferta{{n.pk}}">
                                                                            {% endif %}
                                                                            <label></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                        </td>
                                                    </tr>
                                                    <tr class={% if n.envio_n_o_opcion == 'No se necesita' or  n.envio_n_o_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga' %} "positive"
                                                        {% endif %}>
                                                        <td>
                                                            <div class="ui form">
                                                                <div class="inline fields">
                                                                    <div class="ten wide field mt-5">
                                                                        <i class="truck icon"></i>
                                                                        &nbsp;&nbsp;Envío:
                                                                    </div>
                                                                    <div class="six wide field">
                                                                        <div class="ui fitted toggle checkbox">
                                                                            {% if n.envio_n_o_opcion == 'No se necesita' or n.envio_n_o_opcion == 'Queredor se encarga' or n.envio_n_o_opcion == 'Ofertante se encarga' %}

                                                                            <input type="checkbox"
                                                                                id="check-oferta{{n.pk}}" checked
                                                                                disabled
                                                                                data-checkbox-id="check-oferta{{n.pk}}">
                                                                            <input type="hidden"
                                                                                name="check_oferta_envio" value="1"
                                                                                checked>
                                                                            {% else %}
                                                                            <input type="checkbox"
                                                                                name="check_oferta_envio" value="1"
                                                                                id="check-oferta{{n.pk}}"
                                                                                data-checkbox-id="check-oferta{{n.pk}}">
                                                                            {% endif %}
                                                                            <label></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <div class="ui form">
                                                                <div class="inline fields">
                                                                    <div class="ten wide field mt-5">
                                                                        <i class="balance scale icon"></i>
                                                                        &nbsp;&nbsp;Precio:
                                                                    </div>
                                                                    <div class="six wide field">
                                                                        <div class="ui fitted toggle checkbox">
                                                                            <input type="checkbox"
                                                                                name="check_oferta_precio" value="1"
                                                                                id="check-oferta{{n.pk}}"
                                                                                data-checkbox-id="check-oferta{{n.pk}}">
                                                                            <label></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </form>
                                        </table>
                                    </div>
                                    {% else %}
                                    {% endif %}


                                    <div class="four wide column">
                                        <div class="ui fluid vertical buttons">

                                            {% if n.status_n == 'Pendiente' %}
                                            {% if obj.queredor.user == request.user %}
                                            <div class="ui label mb-5 center aligned massive pink segment"><i
                                                    class="clock icon"></i>Esperando Tu Respuesta
                                            </div>
                                            {% else %}
                                            <div class="ui label mb-5 center aligned massive teal segment"><i
                                                    class="clock icon"></i>Esperando Respuesta
                                            </div>
                                            {% endif %}
                                            {% elif n.status_n == 'Negociando' %}
                                            <div class="ui label mb-5 center aligned massive violet segment"><i
                                                    class="clock icon"></i>Esperando Nueva Oferta
                                            </div>
                                            {% elif n.status_n == 'Rechazada' %}
                                            <div class="ui label mb-5 center aligned massive red segment"><i
                                                    class="ban icon"></i>Oferta
                                                Rechazada
                                            </div>
                                            {% elif n.status_n == 'Aceptada' %}
                                            <div class="ui label mb-5 center aligned green massive segment">
                                                <i class="trophy icon"></i> Oferta Aceptada</div>

                                            {% elif obj.queredor.user == request.user and obj.get_ofertas_num == 0 %}
                                            <div class="ui label mb-5 center aligned massive violet segment"><i
                                                    class="ban icon"></i>Esperando x Ofertas
                                            </div>hourglass half
                                            {% elif obj.queredor.user != request.user %}
                                            {% if user.is_authenticated %}
                                            <a>
                                                <button type="submit" name="submit_o_form"
                                                    form="form_tabla_oferta{{obj.pk}}" value={{obj.pk}}
                                                    class="ui inverted violet huge button mb-5" id="enviar-oferta"><i
                                                        class="bullhorn icon"></i>Ofrecer
                                                </button>
                                            </a>
                                            {% else %}
                                            <a href={% url 'login' %}?next={{request.path}}>
                                                <button class="ui inverted violet huge button mb-5"><i
                                                        class="bullhorn icon"></i>
                                                    Ofrecer
                                                </button>
                                            </a>
                                            {% endif %}
                                            {% endif %}

                                            {% if n.status_n == 'Negociando' and obj.queredor.user != request.user %}
                                            <a>
                                                <button type="submit" name="submit_nego_form_2"
                                                    form="form_tabla_nego_2{{n.pk}}" value={{n.pk}}
                                                    class="ui inverted violet huge button mb-5"
                                                    id="enviar-oferta-checkbox"><i
                                                        class="envelope outline icon"></i>Enviar
                                                    Nueva
                                                    Oferta
                                                </button>
                                            </a>
                                            {% elif n.status_n == 'Pendiente' and obj.queredor.user == request.user %}
                                            <a>
                                                <button type="submit" name="submit_nego_form_1"
                                                    form="form_tabla_nego_1{{n.pk}}" value={{n.pk}}
                                                    class="ui inverted purple huge button mb-5"
                                                    data-nueva-propuesta-id="{{n.pk}}"
                                                    id="enviar-propuesta-checkbox{{n.pk}}"><i
                                                        class="envelope outline icon"></i>Enviar
                                                    Nueva
                                                    Propuesta WEWE {{n.pk}}
                                                </button>
                                            </a>

                                            <form action="{% url 'quieros:oferta-aceptar' %}" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" name="quiero_pk_aceptar" value={{obj.pk}}>
                                                <input type="hidden" name="oferta_pk_aceptar" value={{o.pk}}>
                                                <input type="hidden" name="nego_pk_aceptar" value={{n.pk}}>
                                                <button type="submit" name="submit_a_form"
                                                    class="ui inverted green huge button mb-5"
                                                    data-aceptar-oferta-id="{{n.pk}}"
                                                    id="aceptar-oferta-checkbox{{n.pk}}" style="display: none;">
                                                    <i class="handshake icon"></i>SSAceptar q{{obj.pk}} o{{o.pk}}
                                                    n{{n.pk}}</button>
                                            </form>

                                            {% endif %}

                                            {% if obj.queredor.user == request.user %}
                                            <a href="{% url 'quieros:negociacion-view' obj.slug %}">
                                                <button type="button" class="ui inverted blue big button mb-5"><i
                                                        class="list ol icon"></i>Ofertas Anteriores {{obj.slug}}
                                                </button>
                                            </a>

                                            {% if n.status_n == "Pendiente" or n.status_n == "Negociando"  %}
                                            <form action="{% url 'quieros:oferta-rechazar' %}" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" name="oferta_pk_rechazo" value={{o.pk}}>
                                                <button type="submit" name="submit_r_form"
                                                    class="ui inverted red button mb-5 w-full"><i
                                                        class="trash alternate icon">
                                                    </i>Rechazar Oferta q{{obj.pk}} o{{o.pk}}</button>
                                            </form>
                                            {% endif %}

                                            {% endif %}

                                            {% for n in acu_o %}
                                            {% if n.ofertante_n.quiero_o == o.quiero_o and n.ofertante_n.ofertante.user == o.ofertante.user %}
                                            <a href="{% url 'quieros:negociacion-view' obj.slug %}">
                                                <button type="button" class="ui inverted blue big button mb-5"><i
                                                        class="list ol icon"></i>Ofertas Anteriores {{obj.slug}}
                                                </button>
                                            </a>

                                            {% if n.status_n == "Pendiente" or n.status_n == "Negociando"  %}
                                            <form action="{% url 'quieros:oferta-rechazar' %}" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" name="oferta_pk_rechazo" value={{o.pk}}>
                                                <a>
                                                    <button type="submit" name="submit_r_form"
                                                        class="ui inverted red large button mb-5"><i
                                                            class="x alternate icon">
                                                        </i>Retirar Ofertas</button>
                                                </a>
                                            </form>
                                            {% endif %}

                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="extra content">{{n.slug}}//{{obj.ofertantes}}//q{{obj.pk}} o{{o.pk}}
                                n{{n.pk}}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
            </div>






































            <!-- Primera Oferta-->
            {% else %}

            <div class="content">
                <div class="ui grid container stackable">
                    <div class="row">
                        <div class={% if obj.queredor.user != request.user %} "seven wide column"
                            {% else %} "twelve wide column" {% endif %}>
                            <table class="ui table teal">
                                <thead>
                                    <tr>
                                        <th>
                                            <h4 class="ui header teal">
                                                Quiero creado HH
                                            </h4>
                                        </th>
                                        <th class="center aligned">
                                            <h4 class="ui header teal">
                                                hace
                                            </h4>
                                        </th>
                                        <th class="center aligned">
                                            <h5 class="ui header teal">
                                                {{obj.created|timesince}}
                                            </h5>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        {% if obj.obs_q is None or obj.obs_q == "" %}
                                        <td class="positive">
                                            <i class="icon comment outline"></i>Comentarios:
                                        </td>
                                        <td class="positive"></td>

                                        <td class="positive center aligned">
                                            <div class="ui disabled green inverted tiny button">
                                                Sin <p>Comentarios
                                                </p>
                                            </div>
                                        </td>
                                        {% else %}
                                        <td class="warning">
                                            <i class="icon comment outline"></i>Comentarios:
                                        </td>
                                        <td class="warning center aligned"><i class="icon attention"></i>
                                        </td>
                                        <td class="warning center aligned">
                                            <label class="ui orange pop tiny inverted button" data-title="Comentario:"
                                                data-content="
                                            {{obj.obs_q}} ">
                                                Ver<p>Comentario</p>
                                            </label>
                                        </td>
                                        {% endif %}
                                    </tr>


                                    <tr>
                                        <td><i class="sort numeric up icon"></i>Cantidad<p>
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;querida:
                                            </p>
                                        </td>
                                        <td></td>

                                        <td class="center aligned">
                                            <strong>{{obj.cantidad_q}}</strong></td>
                                    </tr>

                                    {% if obj.fecha_q_opcion == 'Sin Fecha' %}
                                    <tr class="positive">
                                        <td> <i class="calendar  icon"> </i>
                                            Sin
                                            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fecha:
                                            </p>
                                        </td>
                                        <td></td>
                                        <td class="center aligned"><strong>Sin Fecha</strong>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr class={% if obj.fecha_q_opcion == 'Fecha Exacta' %} "warning" {% endif %}>
                                        <td> <i class="calendar  icon"> </i>
                                            {{obj.fecha_q_opcion|slice:":5"}}
                                            <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{obj.fecha_q_opcion|slice:"6:12"}}:
                                            </p>
                                        </td>
                                        <td></td>
                                        <td class="center aligned">
                                            <strong>{{obj.fecha_q|date:"d-m-Y"}}</strong></td>
                                    </tr>
                                    {% endif %}

                                    <tr class={% if obj.envio_q_opcion == 'No se necesita' or obj.envio_q_opcion == 'Queredor se encarga' %}"positive"
                                        {% endif %}>
                                        <td><i class="shipping fast icon"></i>
                                            Tipo de<p>
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envio:
                                                {{obj.comuna_q}}
                                            </p>
                                        </td>
                                        <td class="center aligned"></td>

                                        <td class="center aligned"><strong>

                                                {% if obj.queredor.user != request.user %}


                                                {% if obj.envio_q_opcion == 'No se necesita'  %}
                                                No se necesita
                                                {% elif obj.envio_q_opcion == 'Queredor se encarga' %}
                                                Él se encarga
                                                {% elif obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                Tu te haces cargo
                                                {% endif %}

                                                {% else %}
                                                {% if obj.envio_q_opcion == 'No se necesita'  %}
                                                No se necesita
                                                {% elif obj.envio_q_opcion == 'Queredor se encarga' %}
                                                Yo me encargo
                                                {% elif obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                Él se hace cargo
                                                {% endif %}
                                                {% endif %}
                                            </strong></td>
                                    </tr>
                                    <tr class={% if obj.envio_q_opcion == 'No se necesita' or obj.envio_q_opcion == 'Queredor se encarga' %}"positive"
                                        {% endif %}>
                                        <td><i class="world icon"></i>
                                            Destino
                                            <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Final:
                                            </p>

                                        </td>
                                        <td></td>
                                        <td class="center aligned">
                                            <strong>{{obj.comuna_q_opcion}}</strong>

                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>




                        {% if obj.queredor.user != request.user %}
                        <div class="five wide column">
                            <table class="ui table violet">
                                <thead>
                                    <tr>
                                        <th class="center aligned">
                                            <h4 class="ui header violet">
                                                Nueva Oferta AA
                                            </h4>
                                        </th>
                                    </tr>
                                </thead>

                                <form method="POST" id="form_tabla_oferta{{obj.pk}}" action="{% url 'quieros:oferta' %}"
                                    enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="hidden" name="quiero_pk" value={{obj.pk}}>
                                    <tbody>

                                        <tr>
                                            <td>
                                                <div class="ui form">
                                                    <div class="inline fields mb-1">
                                                        <div class="eleven wide field">
                                                            <textarea type="text" name="obs_o " placeholder="Comentario"
                                                                cols="30" rows="1" style="resize: none;"></textarea>
                                                        </div>
                                                        <div class="five wide field mb-1">
                                                            <div>
                                                                <label for="file-o-{{obj.pk}}"
                                                                    class="ui red inverted small button"
                                                                    style="width:98px">
                                                                    Subir Imagen</label>
                                                                <input type="file" id="file-o-{{obj.pk}}"
                                                                    style="display:none" name="imagen_o">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>
                                                <div class="ui form">
                                                    <div class="inline fields mb-0">
                                                        <div class="ten wide field">
                                                            <i
                                                                class="sort numeric up icon"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                            Cantidad:
                                                        </div>
                                                        <div class="six wide field">

                                                            <input type="number" name="cantidad_o" placeholder="Nueva"
                                                                style="width:117px" pattern="[0-9]+" min="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class={% if obj.fecha_q_opcion == 'Sin Fecha' %}"positive"
                                            {% elif obj.fecha_q_opcion == 'Fecha Exacta' %} "warning" {% endif %}>
                                            <td>
                                                <div class="ui form">
                                                    <div class="inline fields mb-0">
                                                        <div class="ten wide field">
                                                            <i class="calendar  icon"> </i>
                                                            {% if obj.fecha_q_opcion == 'Fecha Límite' %}
                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fecha
                                                            de envio
                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;estimada:
                                                            {% else %}
                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{obj.fecha_q_opcion}}:
                                                            {% endif %}

                                                        </div>
                                                        <div class="six wide field">
                                                            {% if obj.fecha_q_opcion == 'Sin Fecha' %}
                                                            <div class="ui calendar">
                                                                <input type="text" autocomplete="off"
                                                                    style="width:117px" value="Sin Fecha" disabled>
                                                                <input type="hidden" name="fecha_calendario_o" value="">
                                                            </div>
                                                            {% elif obj.fecha_q_opcion == 'Fecha Exacta' %}
                                                            <div class="ui calendar" id="fecha-calendario-o"
                                                                data-min-date="{{obj.fecha_q}}"
                                                                data-max-date="{{obj.fecha_q}}">
                                                                <input type="text" autocomplete="off"
                                                                    value="{{obj.fecha_q}}" disabled
                                                                    style="width:117px">
                                                                <input type="hidden" name="fecha_calendario_o"
                                                                    value="{{obj.fecha_q}}">
                                                            </div>
                                                            {% else %}

                                                            {% if fecha_hoy == obj.fecha_q|date:"d-m-Y" %}
                                                            <div class="ui calendar" id="fecha-calendario-o"
                                                                data-min-date="{{obj.fecha_q}}"
                                                                data-max-date="{{obj.fecha_q}}">
                                                                <input type="text" autocomplete="off"
                                                                    value="{{obj.fecha_q}}" disabled
                                                                    style="width:117px">
                                                                <input type="hidden" name="fecha_calendario_o"
                                                                    value="{{obj.fecha_q}}">
                                                            </div>
                                                            {% else %}
                                                            <div class="ui calendar" id="fecha-calendario-o"
                                                                data-min-date={% now "d-m-Y" %}
                                                                data-max-date="{{obj.fecha_q|date:"d-m-Y"}}">
                                                                <input type="text" name="fecha_calendario_o"
                                                                    placeholder="Fecha" autocomplete="off"
                                                                    style="width:117px">
                                                            </div>
                                                            {% endif %}
                                                            {% endif %}

                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class={% if obj.envio_q_opcion == 'No se necesita' or obj.envio_q_opcion == 'Queredor se encarga' %}"positive"
                                            {% endif %}>
                                            <td>
                                                <div class="ui form">
                                                    <div class="inline fields mb-0">
                                                        <div {% if obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                            class="seven wide field" {% else %} class="ten wide field"
                                                            {% endif %}>
                                                            <i class="shipping fast alternate outline icon"></i>
                                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Envio:

                                                        </div>
                                                        <div {% if obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                            class="ten wide field" {% else %} class="six wide field"
                                                            {% endif %}>

                                                            {% if obj.envio_q_opcion == 'No se necesita' %}
                                                            <input type="text" value="No se necesita"
                                                                style="width:117px" disabled>
                                                            <input type="hidden" name="envio_radio_o"
                                                                value="No se necesita">
                                                            {% elif obj.envio_q_opcion == 'Queredor se encarga' %}
                                                            <input type="text" value="Él se encarga" style="width:117px"
                                                                disabled>
                                                            <input type="hidden" name="envio_radio_o"
                                                                value="Él se encarga">
                                                            {% elif obj.envio_q_opcion == 'Ofertante se encarga' %}
                                                            <div class="field">
                                                                <div class="ui radio checkbox">
                                                                    <input type="radio" name="envio_radio_o" checked=""
                                                                        value="ofertante_se_encarga" tabindex="0"
                                                                        class="hidden">
                                                                    <label>Yo me encargo</label>
                                                                </div>
                                                            </div>
                                                            <div class="field">
                                                                <div class="ui radio checkbox">
                                                                    <input type="radio" name="envio_radio_o"
                                                                        value="otro_se_encarga" tabindex="0"
                                                                        class="hidden">
                                                                    <label>Otra Empresa</label>
                                                                </div>
                                                            </div>
                                                            {% endif %}

                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="ui form">
                                                    <div class="inline fields mb-0">
                                                        <div class="ten wide field">
                                                            <i
                                                                class="balance scale icon"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Precio
                                                            Final:
                                                        </div>
                                                        <div class="six wide field">
                                                            <input type="number" name="precio_o" placeholder="Nueva"
                                                                style="width:117px" pattern="[0-9]+">
                                                        </div>
                                                    </div>
                                                </div>

                                            </td>
                                        </tr>
                                    </tbody>
                            </table>
                            </form>
                        </div>

                        {% endif %}

                        <!-- No hay negociaciones -->
                        <div class="four wide column">
                            <div class="ui fluid vertical buttons">

                                {% if n.status_n == 'Pendiente' %}
                                {% if obj.queredor.user == request.user %}
                                <div class="ui label mb-5 center aligned massive pink segment">
                                    <i class="clock icon"></i>Esperando Tu Respuesta
                                </div>
                                {% else %}
                                <div class="ui label mb-5 center aligned massive teal segment">
                                    <i class="clock icon"></i>Esperando RespuestaZZ
                                </div>
                                {% endif %}
                                {% elif n.status_n == 'Negociando' %}
                                <div class="ui label mb-5 center aligned massive teal segment">
                                    <i class="clock icon"></i>Esperando Tu Oferta
                                </div>
                                {% elif n.status_n == 'Rechazada' %}
                                <div class="ui label mb-5 center aligned massive red segment"><i
                                        class="ban icon"></i>Oferta
                                    Rechazada
                                </div>
                                {% elif n.status_n == 'Aceptada' %}
                                <div class="ui label mb-5 center aligned green massive segment">
                                    <i class="trophy icon"></i> Oferta Aceptada</div>

                                {% elif obj.queredor.user == request.user and obj.get_ofertas_num == 0 %}
                                <div class="ui label mb-5 center aligned massive violet segment">
                                    <i class="ban icon"></i>Esperando x Ofertas
                                </div>hourglass half
                                {% elif obj.queredor.user != request.user %}

                                {% if user.is_authenticated %}
                                <a>
                                    <button type="submit" name="submit_o_form" form="form_tabla_oferta{{obj.pk}}"
                                        value={{obj.pk}} class="ui inverted violet huge button mb-5"
                                        id="enviar-oferta"><i class="bullhorn icon"></i>Ofrecer
                                    </button>
                                </a>
                                {% else %}
                                <a href={% url 'login' %}?next={{request.path}}>
                                    <button class="ui inverted violet huge button mb-5"><i class="bullhorn icon"></i>
                                        Ofrecer
                                    </button>
                                </a>
                                {% endif %}
                                {% endif %}

                                {% if n.status_n == 'Negociando' and obj.queredor.user != request.user %}
                                <a>
                                    <button type="submit" name="submit_nego_form_2" form="form_tabla_nego_2{{n.pk}}"
                                        value={{n.pk}} class="ui inverted violet huge button mb-5"
                                        id="enviar-oferta-checkbox"><i class="envelope outline icon"></i>Enviar
                                        Nueva
                                        Oferta
                                    </button>
                                </a>
                                {% elif n.status_n == 'Pendiente' and obj.queredor.user == request.user %}
                                <a>
                                    <button type="submit" name="submit_nego_form_1" form="form_tabla_nego_1{{n.pk}}"
                                        value={{n.pk}} class="ui inverted purple huge button mb-5"
                                        data-nueva-propuesta-id="{{n.pk}}" id="enviar-propuesta-checkbox{{n.pk}}"><i
                                            class="envelope outline icon"></i>Enviar
                                        Nueva
                                        Propuesta WEWE {{n.pk}}
                                    </button>
                                </a>

                                {% endif %}



                                {% for n in acu_o %}
                                {% if n.ofertante_n.quiero_o == o.quiero_o and n.ofertante_n.ofertante.user == o.ofertante.user %}
                                <a href="{% url 'quieros:negociacion-view' obj.slug %}">
                                    <button type="button" class="ui inverted blue big button mb-5"><i
                                            class="list ol icon"></i>Ofertas Anteriores
                                        {{obj.slug}}
                                    </button>
                                </a>
                                <form action="{% url 'quieros:oferta-rechazar' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="oferta_pk_rechazo" value={{o.pk}}>
                                    <a>
                                        <button type="submit" name="submit_r_form"
                                            class="ui inverted red large button mb-5"><i class="x alternate icon">
                                            </i>Retirar Ofertas</button>
                                    </a>
                                </form>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="extra content">
                qslug{{obj.slug}}//oslug{{o.slug}}//nslug{{n.slug}}//{{obj.ofertantes}}//q{{obj.pk}}
                o{{o.pk}}
                n{{n.pk}}
            </div>

            {% endif %}
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
</div>


{% endblock content %}







{% block scripts %}

<script>
    $(document).ready(function () {
        let display = false

        $(".abrir_q_btn").click(function () {
            let cb_id = $(this).data('ver-id');
            console.log(cb_id);

            if (display === false) {
                $(this).text("Cerrar");
                $("#cb" + cb_id).slideDown();
                display = true;

            } else {
                $(this).text("Ver");
                $("#cb" + cb_id).slideUp();
                display = false;

            }
        });
    });

    $(".ui").each(function () {
        let check_id = $(this).data('nueva-propuesta-id');
        $("#aceptar-oferta-checkbox" + check_id).hide();

        $('[type="checkbox"]').click(function () {
            if ($('input[type = "checkbox"][id="check-oferta' + check_id +
                    '"]:checked')
                .length == 4)

                $("#enviar-propuesta-checkbox" + check_id).hide() &&
                $("#aceptar-oferta-checkbox" + check_id).show();

            else $("#enviar-propuesta-checkbox" + check_id).show() &&
                $("#aceptar-oferta-checkbox" + check_id).hide();

        });
    });




    $('.nego-tabs').each(function () {
        let nego_tabs_id = $(this).data('nego-tabs-id');
        console.log(nego_tabs_id);
        $('#context-tab' + nego_tabs_id + ' .menu .item').tab({
            context: $('#context-tab' + nego_tabs_id)
        });
    });




    $('.orange.pop.button')
        .popup({
            on: 'click'
        });
    $('input')
        .popup({
            on: 'focus'
        });
</script>


{% endblock scripts %}